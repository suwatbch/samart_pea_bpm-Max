//----------------------------------------------------------------------------------------
// patterns & practices - Smart Client Software Factory - Guidance Package
//
// This file was generated by the "Add View" recipe.
//
// A presenter calls methods of a view to update the information that the view displays. 
// The view exposes its methods through an interface definition, and the presenter contains
// a reference to the view interface. This allows you to test the presenter with different 
// implementations of a view (for example, a mock view).
//
// For more information see:
// ms-help://MS.VSCC.v80/MS.VSIPCC.v80/ms.scsf.2006jun/SCSF/html/03-030-Model%20View%20Presenter%20%20MVP%20.htm
//
// Latest version of this Guidance Package: http://go.microsoft.com/fwlink/?LinkId=62182
//----------------------------------------------------------------------------------------

using System;
using Microsoft.Practices.ObjectBuilder;
using Microsoft.Practices.CompositeUI;
using PEA.BPM.Infrastructure.Interface;
using Microsoft.Practices.CompositeUI.EventBroker;
using System.Collections.Generic;
using System.Windows.Forms;
using Microsoft.Reporting.WinForms;
using PEA.BPM.ePaymentsModule.Interface.Services;
using PEA.BPM.ePaymentsModule.Interface.Constants;
using PEA.BPM.ePaymentsModule.Interface.BusinessEntities.Reports;
using PEA.BPM.ePaymentsModule.Interface.BusinessEntities;
using PEA.BPM.ePaymentsModule.Services;
using PEA.BPM.Architecture.CommonUtilities;
using System.Globalization;

namespace PEA.BPM.ePaymentsModule
{
    public class ResultViewPresenter : Presenter<IResultView>
    {
        private IReportService _reportService;
        private ReportDataSource dataSource;
        private ReportParameter[] paramList;
        private string reportName;

        #region Init

        [InjectionConstructor]
        public ResultViewPresenter([ServiceDependency] IReportService reportService)
        {
            _reportService = reportService;
        }

        public override void OnViewReady()
        {
            base.OnViewReady();
        }

        public void OnCloseView()
        {
            base.CloseView();
        }

        #endregion

        #region Event Subscription

        [EventSubscription(EventTopicNames.RE_01Report, Thread = ThreadOption.UserInterface)]
        public void SearchClearifiedHandler(object sender, EventArgs<RE01Param> e)
        {
            List<RE01_ReportInfo> reportList = _reportService.GetRe01ReportService(e.Data);
            if (reportList.Count > 0)
            {
                reportName = "PEA.BPM.ePaymentsModule.Reports.RE_01Report.rdlc";
                dataSource = new ReportDataSource();
                dataSource.Name = "PEA_BPM_ePaymentsModule_Interface_BusinessEntities_Reports_RE01_ReportInfo";
                dataSource.Value = reportList;
                paramList = new ReportParameter[1];
                paramList[0] = new ReportParameter("currentDate", DateFormatter.ToDateTimeThString(DateTime.Now));
                View.ShowReport(reportName, dataSource, paramList);
            }
            else
            {
                MessageBox.Show("ไม่พบข้อมูลรายงาน ตามเงื่อนไขที่กำหนด", "ข้อความ", MessageBoxButtons.OK, MessageBoxIcon.Information);
                View.ResetReport();
            }
        }

        [EventSubscription(EventTopicNames.RE_02Report, Thread = ThreadOption.UserInterface)]
        public void SearchClearifiedHandler(object sender, EventArgs<RE02ParamInfo> e)
        {
            List<RE02_ReportInfo> reportList = _reportService.GetRe02ReportService(e.Data);
            if (reportList.Count > 0)
            {
                reportName = "PEA.BPM.ePaymentsModule.Reports.RE_02Report.rdlc";
                dataSource = new ReportDataSource();
                dataSource.Name = "PEA_BPM_ePaymentsModule_Interface_BusinessEntities_Reports_RE02_ReportInfo";
                dataSource.Value = reportList;
                paramList = new ReportParameter[1];
                paramList[0] = new ReportParameter("currentDate", DateFormatter.ToDateTimeThString(DateTime.Now));
                View.ShowReport(reportName, dataSource, paramList);
            }
            else
            {
                MessageBox.Show("ไม่พบข้อมูลรายงาน ตามเงื่อนไขที่กำหนด", "ข้อความ", MessageBoxButtons.OK, MessageBoxIcon.Information);
                View.ResetReport();
            }
        }

        [EventSubscription(EventTopicNames.RE_03Report, Thread = ThreadOption.UserInterface)]
        public void SearchClearifiedHandler(object sender, EventArgs<RE03ParamInfo> e)
        {
            DateTime currentDate = DateTime.Now;
            List<RE03_ReportInfo> reportList = _reportService.GetRe03ReportService(e.Data);
            if (reportList.Count > 0)
            {
                reportName = "PEA.BPM.ePaymentsModule.Reports.RE_03Report.rdlc";
                dataSource = new ReportDataSource();
                dataSource.Name = "PEA_BPM_ePaymentsModule_Interface_BusinessEntities_Reports_RE03_ReportInfo";
                dataSource.Value = reportList;
                paramList = new ReportParameter[3];
                paramList[0] = new ReportParameter("currentDate", DateFormatter.ToDateTimeThString(currentDate));
                paramList[1] = new ReportParameter("month", StringConvert.GetMonthName(e.Data.PayDt.Value.Month));
                paramList[2] = new ReportParameter("year", DateFormatter.ToYearThString(e.Data.PayDt.Value));
                View.ShowReport(reportName, dataSource, paramList);
            }
            else
            {
                MessageBox.Show("ไม่พบข้อมูลรายงาน ตามเงื่อนไขที่กำหนด", "ข้อความ", MessageBoxButtons.OK, MessageBoxIcon.Information);
                View.ResetReport();
            }
        }

        [EventSubscription(EventTopicNames.RE_04Report, Thread = ThreadOption.UserInterface)]
        public void SearchClearifiedHandler(object sender, EventArgs<RE04ParamInfo> e)
        {
            DateTime currentDate = DateTime.Now;
            List<RE04_ReportInfo> reportList = _reportService.GetRe04ReportService(e.Data);
            if (reportList.Count > 0)
            {
                reportName = "PEA.BPM.ePaymentsModule.Reports.RE_04Report.rdlc";
                dataSource = new ReportDataSource();
                dataSource.Name = "PEA_BPM_ePaymentsModule_Interface_BusinessEntities_Reports_RE04_ReportInfo";
                dataSource.Value = reportList;
                paramList = new ReportParameter[3];
                paramList[0] = new ReportParameter("currentDate", DateFormatter.ToDateTimeThString(currentDate));
                paramList[1] = new ReportParameter("month", StringConvert.GetMonthName(e.Data.PayDt.Value.Month));
                paramList[2] = new ReportParameter("year", DateFormatter.ToYearThString(e.Data.PayDt.Value));
                View.ShowReport(reportName, dataSource, paramList);
            }
            else
            {
                MessageBox.Show("ไม่พบข้อมูลรายงาน ตามเงื่อนไขที่กำหนด", "ข้อความ", MessageBoxButtons.OK, MessageBoxIcon.Information);
                View.ResetReport();
            }
        }

        [EventSubscription(EventTopicNames.RE_05Report, Thread = ThreadOption.UserInterface)]
        public void RE_05Report(object sender, EventArgs<RE05ParamInfo> e)
        {
            RE05ParamInfo param = (RE05ParamInfo)e.Data;
            List<RE05_ReportInfo> reportList = _reportService.GetRe05ReportService(param);
            if (reportList.Count > 0)
            {
                ReportParameter[] ps = new ReportParameter[2];
                ps[0] = new ReportParameter("PrintDate", DateTime.Now.ToString("dd/MM/yyyy  HH:mm", new CultureInfo("th-TH")));
                ps[1] = new ReportParameter("Period", String.Format("{0} {1}", StringConvert.GetMonthName(param.PayDate.Value.Month), param.PayDate.Value.ToString("yyyy", new CultureInfo("th-TH"))));

                reportName = "PEA.BPM.ePaymentsModule.Reports.RE_05Report.rdlc";
                dataSource = new ReportDataSource();
                dataSource.Name = "PEA_BPM_ePaymentsModule_Interface_BusinessEntities_Reports_RE05_ReportInfo";
                dataSource.Value = reportList;
                View.ShowReport(reportName, dataSource, ps);
            }
            else
            {
                MessageBox.Show("ไม่พบข้อมูลรายงาน ตามเงื่อนไขที่กำหนด", "ข้อความ", MessageBoxButtons.OK, MessageBoxIcon.Information);
                View.ResetReport();
            }
        }

        [EventSubscription(EventTopicNames.RE_06Report, Thread = ThreadOption.UserInterface)]
        public void Show06ReportHandler(object sender, EventArgs<RE06ParamInfo> e)
        {
            List<RE06_ReportInfo> reportList = _reportService.GetRe06ReportInfo(e.Data);
            if (reportList.Count > 0)
            {
                ReportParameter[] ps = new ReportParameter[1];
                ps[0] = new ReportParameter("PrintDate", DateTime.Now.ToString("dd/MM/yyyy  HH:mm", new CultureInfo("th-TH")));

                reportName = "PEA.BPM.ePaymentsModule.Reports.RE_06Report.rdlc";
                dataSource = new ReportDataSource();
                dataSource.Name = "PEA_BPM_ePaymentsModule_Interface_BusinessEntities_Reports_RE06_ReportInfo";
                dataSource.Value = reportList;
                View.ShowReport(reportName, dataSource, ps);
            }
            else
            {
                MessageBox.Show("ไม่พบข้อมูลรายงาน ตามเงื่อนไขที่กำหนด", "ข้อความ", MessageBoxButtons.OK, MessageBoxIcon.Information);
                View.ResetReport();
            }
        }

        [EventSubscription(EventTopicNames.RE_07Report, Thread = ThreadOption.UserInterface)]
        public void Show07ReportHandler(object sender, EventArgs<RE07ParamInfo> e)
        {
            List<RE07_ReportInfo> reportList = _reportService.GetRe07ReportInfo(e.Data);
            if (reportList.Count > 0)
            {
                ReportParameter[] ps = new ReportParameter[1];
                ps[0] = new ReportParameter("PrintDate", DateTime.Now.ToString("dd/MM/yyyy  HH:mm", new CultureInfo("th-TH")));

                reportName = "PEA.BPM.ePaymentsModule.Reports.RE_07Report.rdlc";
                dataSource = new ReportDataSource();
                dataSource.Name = "PEA_BPM_ePaymentsModule_Interface_BusinessEntities_Reports_RE07_ReportInfo";
                dataSource.Value = reportList;
                View.ShowReport(reportName, dataSource, ps);
            }
            else
            {
                MessageBox.Show("ไม่พบข้อมูลรายงาน ตามเงื่อนไขที่กำหนด", "ข้อความ", MessageBoxButtons.OK, MessageBoxIcon.Information);
                View.ResetReport();
            }
        }

        [EventSubscription(EventTopicNames.RE_08Report, Thread = ThreadOption.UserInterface)]
        public void Show08ReportHandler(object sender, EventArgs<RE08ParamInfo> e)
        {
            List<RE08_ReportInfo> reportList = _reportService.GetRe08ReportInfo(e.Data);
            if (reportList.Count > 0)
            {
                ReportParameter[] ps = new ReportParameter[1];
                ps[0] = new ReportParameter("PrintDate", DateTime.Now.ToString("dd/MM/yyyy  HH:mm", new CultureInfo("th-TH")));

                reportName = "PEA.BPM.ePaymentsModule.Reports.RE_08Report.rdlc";
                dataSource = new ReportDataSource();
                dataSource.Name = "PEA_BPM_ePaymentsModule_Interface_BusinessEntities_Reports_RE08_ReportInfo";
                dataSource.Value = reportList;
                View.ShowReport(reportName, dataSource, ps);
            }
            else
            {
                MessageBox.Show("ไม่พบข้อมูลรายงาน ตามเงื่อนไขที่กำหนด", "ข้อความ", MessageBoxButtons.OK, MessageBoxIcon.Information);
                View.ResetReport();
            }
        }

        [EventSubscription(EventTopicNames.RE_09Report, Thread = ThreadOption.UserInterface)]
        public void Show09ReportHandler(object sender, EventArgs<RE09ParamInfo> e)
        {
            List<RE09_ReportInfo> reportList = _reportService.GetRe09ReportInfo(e.Data);
            if (reportList.Count > 0)
            {
                ReportParameter[] ps = new ReportParameter[1];
                ps[0] = new ReportParameter("PrintDate", DateTime.Now.ToString("dd/MM/yyyy  HH:mm", new CultureInfo("th-TH")));

                reportName = "PEA.BPM.ePaymentsModule.Reports.RE_09Report.rdlc";
                dataSource = new ReportDataSource();
                dataSource.Name = "PEA_BPM_ePaymentsModule_Interface_BusinessEntities_Reports_RE09_ReportInfo";
                dataSource.Value = reportList;
                View.ShowReport(reportName, dataSource, ps);
            }
            else
            {
                MessageBox.Show("ไม่พบข้อมูลรายงาน ตามเงื่อนไขที่กำหนด", "ข้อความ", MessageBoxButtons.OK, MessageBoxIcon.Information);
                View.ResetReport();
            }
        }


        #endregion
    }
}

