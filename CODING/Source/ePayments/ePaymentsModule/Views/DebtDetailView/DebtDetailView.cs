//----------------------------------------------------------------------------------------
// patterns & practices - Smart Client Software Factory - Guidance Package
//
// This file was generated by the "Add View" recipe.
//
// This class is the concrete implementation of a View in the Model-View-Presenter 
// pattern. Communication between the Presenter and this class is acheived through 
// an interface to facilitate separation and testability.
// Note that the Presenter generated by the same recipe, will automatically be created
// by CAB through [CreateNew] and bidirectional references will be added.
//
// For more information see:
// ms-help://MS.VSCC.v80/MS.VSIPCC.v80/ms.scsf.2006jun/SCSF/html/03-030-Model%20View%20Presenter%20%20MVP%20.htm
//
// Latest version of this Guidance Package: http://go.microsoft.com/fwlink/?LinkId=62182
//----------------------------------------------------------------------------------------

using System;
using System.Windows.Forms;
using Microsoft.Practices.CompositeUI.SmartParts;
using Microsoft.Practices.ObjectBuilder;
using PEA.BPM.Infrastructure.Interface;
using PEA.BPM.Architecture.ArchitectureTool;
using PEA.BPM.Infrastructure.Interface.BusinessEntities;
using System.Collections.Generic;
using PEA.BPM.Architecture.ArchitectureTool.Control;
using System.Drawing;
using System.ComponentModel;
using PEA.BPM.Architecture.CommonUtilities;
using PEA.BPM.ePaymentsModule.Interface.BusinessEntities;
using PEA.BPM.ePaymentsModule.Interface.Constants;

namespace PEA.BPM.ePaymentsModule
{
    [SmartPart]
    public partial class DebtDetailView : UserControl, IDebtDetailView
    {

        #region Constructure

        public DebtDetailView()
        {
            InitializeComponent();
            DebtDetailGV.AutoGenerateColumns = false;
        }

        #endregion

        #region Init

        [CreateNew]
        public DebtDetailViewPresenter Presenter
        {
            set
            {
                _presenter = value;
                _presenter.View = this;
            }
        }

        protected override void OnLoad(EventArgs e)
        {
            _presenter.OnViewReady();
        }

        #endregion 

        #region IDebtDetailView Member

        public void ViewDebtDetail(List<EpayUploadItem> ePayDetail)
        {
            if(ePayDetail.Count > 0)
            {
                txtCaId.Text = ePayDetail[0].CaId;
                txtCaName.Text = ePayDetail[0].CaName;
                txtCaAddress.Text = ePayDetail[0].CaAddress;
                txtAgentName.Text = ePayDetail[0].EpayUploads.CompanyName;
                txtPaymentDate.Text = DateFormatter.ToDateThString(Convert.ToDateTime(ePayDetail[0].PayDt));
                txtPeaCode.Text = ePayDetail[0].ActCode;
                if (ePayDetail[0].UploadStatus == "0")
                {
                    txtStatus.ForeColor = Color.Green;
                }
                else
                {
                    txtStatus.ForeColor = Color.Red;
                }
                txtStatus.Text = EPaymentUploadStatus.GetStatusMessage(ePayDetail[0].UploadStatus);
                ViewDebtComparable(ePayDetail);
            }
        }

        public void ViewDebtComparable(List<EpayUploadItem> ePayDetail)
        {
            DebtDetailGV.DataSource = ePayDetail.ToArray();
            DebtDetailGV.Refresh();
        }

        #endregion

        #region Event Handler

        private void DebtDetailGV_CellFormatting(object sender, DataGridViewCellFormattingEventArgs e)
        {
            if (DebtDetailGV.Rows[e.RowIndex].Cells["StatusGV"].Value == null)
            {
                EpayUploadItem ePayment = (EpayUploadItem)DebtDetailGV.Rows[e.RowIndex].DataBoundItem;
                
                if (e.RowIndex == 0)
                {
                    DebtDetailGV.Rows[e.RowIndex].Cells["DetailGV"].Value = "หมายเลขผู้ใช้ไฟ";
                    DebtDetailGV.Rows[e.RowIndex].Cells["SysDataGV"].Value = ePayment.SysCaId;
                    DebtDetailGV.Rows[e.RowIndex].Cells["FileDataGV"].Value = ePayment.CaId;
                    if (!ePayment.CaId.Equals(ePayment.SysCaId))
                    {
                        DebtDetailGV.Rows[e.RowIndex].Cells["StatusGV"].Value = Properties.Resources.Exclamation;
                    }
                    else
                    {
                        DebtDetailGV.Rows[e.RowIndex].Cells["StatusGV"].Value = Properties.Resources.Pass;
                    }
                }
                else if (e.RowIndex == 1)
                {
                    DebtDetailGV.Rows[e.RowIndex].Cells["DetailGV"].Value = "สาขาการไฟฟ้า";
                    DebtDetailGV.Rows[e.RowIndex].Cells["SysDataGV"].Value = ePayment.SysBranchId;
                    DebtDetailGV.Rows[e.RowIndex].Cells["FileDataGV"].Value = ePayment.BranchId;
                    if(!ePayment.BranchId.Equals(ePayment.SysBranchId))
                    {
                        DebtDetailGV.Rows[e.RowIndex].Cells["StatusGV"].Value = Properties.Resources.Exclamation;
                    }
                    else
                    {
                        DebtDetailGV.Rows[e.RowIndex].Cells["StatusGV"].Value = Properties.Resources.Pass;
                    }
                }
                else if(e.RowIndex == 2)
                {
                    DebtDetailGV.Rows[e.RowIndex].Cells["DetailGV"].Value = "บิลเดือน";
                    DebtDetailGV.Rows[e.RowIndex].Cells["SysDataGV"].Value = ePayment.SysPeriod;
                    DebtDetailGV.Rows[e.RowIndex].Cells["FileDataGV"].Value = ePayment.Period;
                    if (!ePayment.Period.Equals(ePayment.SysPeriod))
                    {
                        DebtDetailGV.Rows[e.RowIndex].Cells["StatusGV"].Value = Properties.Resources.Exclamation;
                    }
                    else
                    {
                        DebtDetailGV.Rows[e.RowIndex].Cells["StatusGV"].Value = Properties.Resources.Pass;
                    }
                }
                else if (e.RowIndex == 3)
                {
                    DebtDetailGV.Rows[e.RowIndex].Cells["DetailGV"].Value = "เลขที่ใบแจ้งหนี้";
                    DebtDetailGV.Rows[e.RowIndex].Cells["SysDataGV"].Value = ePayment.SysInvoiceNo;
                    DebtDetailGV.Rows[e.RowIndex].Cells["FileDataGV"].Value = ePayment.InvoiceNo;
                    if (!ePayment.InvoiceNo.Equals(ePayment.SysInvoiceNo))
                    {
                        DebtDetailGV.Rows[e.RowIndex].Cells["StatusGV"].Value = Properties.Resources.Exclamation;
                    }
                    else
                    {
                        DebtDetailGV.Rows[e.RowIndex].Cells["StatusGV"].Value = Properties.Resources.Pass;
                    }
                }
                else if (e.RowIndex == 4)
                {
                    DebtDetailGV.Rows[e.RowIndex].Cells["DetailGV"].Value = "วันครบกำหนดชำระ";
                    DebtDetailGV.Rows[e.RowIndex].Cells["SysDataGV"].Value = DateFormatter.ToDateThString(Convert.ToDateTime(ePayment.SysDueDate));
                    DebtDetailGV.Rows[e.RowIndex].Cells["FileDataGV"].Value = DateFormatter.ToDateThString(Convert.ToDateTime(ePayment.DueDt));
                    if (!ePayment.DueDt.Equals(ePayment.SysDueDate))
                    {
                        DebtDetailGV.Rows[e.RowIndex].Cells["StatusGV"].Value = Properties.Resources.Exclamation;
                    }
                    else
                    {
                        DebtDetailGV.Rows[e.RowIndex].Cells["StatusGV"].Value = Properties.Resources.Pass;
                    }
                }
                else if (e.RowIndex == 5)
                {
                    DebtDetailGV.Rows[e.RowIndex].Cells["DetailGV"].Value = "ยอดหนี้";
                    DebtDetailGV.Rows[e.RowIndex].Cells["SysDataGV"].Value = ePayment.SysGAmount==null?"":Convert.ToDecimal(ePayment.SysGAmount).ToString("#,###,##0.00");
                    DebtDetailGV.Rows[e.RowIndex].Cells["FileDataGV"].Value = Convert.ToDecimal(ePayment.OutSourceAmount).ToString("#,###,##0.00");
                    if (!ePayment.OutSourceAmount.Equals(ePayment.SysGAmount))
                    {
                        DebtDetailGV.Rows[e.RowIndex].Cells["StatusGV"].Value = Properties.Resources.Exclamation;
                    }
                    else
                    {
                        DebtDetailGV.Rows[e.RowIndex].Cells["StatusGV"].Value = Properties.Resources.Pass;
                    }
                }
                else
                {
                    DebtDetailGV.Rows[e.RowIndex].Cells["DetailGV"].Value = "จำนวนเงินภาษี";
                    DebtDetailGV.Rows[e.RowIndex].Cells["SysDataGV"].Value = ePayment.SysVatAmount==null?"":Convert.ToDecimal(ePayment.SysVatAmount).ToString("#,###,##0.00");
                    DebtDetailGV.Rows[e.RowIndex].Cells["FileDataGV"].Value = Convert.ToDecimal(ePayment.VatAmount).ToString("#,###,##0.00");
                    if (!ePayment.VatAmount.Equals(ePayment.SysVatAmount))
                    {
                        DebtDetailGV.Rows[e.RowIndex].Cells["StatusGV"].Value = Properties.Resources.Exclamation
;
                    }
                    else
                    {
                        DebtDetailGV.Rows[e.RowIndex].Cells["StatusGV"].Value = Properties.Resources.Pass;
                    }
                }
            }
        }

        #endregion

        private void btnOk_Click(object sender, EventArgs e)
        {
            _presenter.OnCloseView();
        }

    }
}

